<!DOCTYPE html>
<html>
<head>
  <title>Admin Map View</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
  <style>
    #map-container {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>

<h2>Admin Map View</h2>
<div id="map-container"></div>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const ADMIN_EMAIL = "your-admin-email@example.com";

  auth.onAuthStateChanged(async user => {
    if (!user) {
      alert("You must be logged in to view this page.");
      window.location.href = "login.html";
      return;
    }

    if (user.email !== ADMIN_EMAIL) {
      alert("You are not authorized to view this page.");
      window.location.href = "index.html";
      return;
    }

    const map = new google.maps.Map(document.getElementById('map-container'), {
      zoom: 5,
      center: { lat: 7.8731, lng: 80.7718 } // Sri Lanka center
    });

    const locationsSnapshot = await db.collection("locations").get();
    locationsSnapshot.forEach(doc => {
      const loc = doc.data();
      if (doc.id !== user.uid && loc.latitude && loc.longitude) {
        new google.maps.Marker({
          position: { lat: loc.latitude, lng: loc.longitude },
          map: map,
          title: loc.email || "User"
        });
      }
    });
  });
</script>

</body>
</html>

